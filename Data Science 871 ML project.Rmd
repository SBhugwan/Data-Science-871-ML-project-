---
# IMPORTANT: Change settings here, but DO NOT change the spacing.
# Remove comments and add values where applicable.
# The descriptions below should be self-explanatory

title: "Helping You Write Academic Papers in R using Texevier"
#subtitle: "This will appear as Right Header"

documentclass: "elsarticle"

# --------- Thesis title (Optional - set to FALSE by default).
# You can move the details below around as you please.
Thesis_FP: FALSE
# Entry1: "An unbelievable study with a title spanning multiple lines."
# Entry2: "\\textbf{Nico Katzke}" # textbf for bold
# Entry3: "A thesis submitted toward the degree of Doctor of Philosophy"
# Uni_Logo: Tex/Logo.png # Place a logo in the indicated location (from your root, e.g. defaults to ~/Tex/Logo.png) and uncomment this line. Leave uncommented for no image
# Logo_width: 0.3 # If using a logo - use this to set width (size) of image
# Entry4: "Under the supervision of: \\vfill Prof. Joe Smith and Dr. Frank Smith"
# Entry5: "Stellenbosch University"
# Entry6: April 2020
# Entry7:
# Entry8:

# --------- Front Page
# Comment: ----- Follow this pattern for up to 5 authors
AddTitle: TRUE # Use FALSE when submitting to peer reviewed platform. This will remove author names.
Author1: "Nico Katzke^[__Contributions:__  \\newline _The authors would like to thank no institution for money donated to this project. Thank you sincerely._]"  # First Author - note the thanks message displayed as an italic footnote of first page.
Ref1: "Github: https://github.com/SBhugwan/Data-Science-871-ML-project-" # First Author's Affiliation
Email1: "21075492\\@sun.ac.za" # First Author's Email address

  # If corresponding author is author 3, e.g., use CorrespAuthor_3: TRUE

# Comment out below to remove both. JEL Codes only given if keywords also given.


# ----- Manage headers and footers:
#BottomLFooter: $Title$
#BottomCFooter:
#TopLHeader: \leftmark # Adds section name at topleft. Remove comment to add it.
BottomRFooter: "\\footnotesize Page \\thepage" # Add a '#' before this line to remove footer.
addtoprule: TRUE
addfootrule: TRUE               # Use if footers added. Add '#' to remove line.

# --------- page margins:
margin: 2.3 # Sides
bottom: 2 # bottom
top: 2.5 # Top
HardSet_layout: TRUE # Hard-set the spacing of words in your document. This will stop LaTeX squashing text to fit on pages, e.g.
# This is done by hard-setting the spacing dimensions. Set to FALSE if you want LaTeX to optimize this for your paper.

# --------- Line numbers
linenumbers: FALSE # Used when submitting to journal

# ---------- References settings:
# You can download cls format here: https://www.zotero.org/ - simply search for your institution. You can also edit and save cls formats here: https://editor.citationstyles.org/about/
# Hit download, store it in Tex/ folder, and change reference below - easy.
bibliography: Tex/ref.bib       # Do not edit: Keep this naming convention and location.
csl: Tex/harvard-stellenbosch-university.csl # referencing format used.
# By default, the bibliography only displays the cited references. If you want to change this, you can comment out one of the following:
#nocite: '@*' # Add all items in bibliography, whether cited or not
# nocite: |  # add specific references that aren't cited
#  @grinold2000
#  @Someoneelse2010

# ---------- General:
RemovePreprintSubmittedTo: TRUE  # Removes the 'preprint submitted to...' at bottom of titlepage
Journal: "Journal of Finance"   # Journal that the paper will be submitting to, if RemovePreprintSubmittedTo is set to TRUE.
toc: FALSE                       # Add a table of contents
numbersections: TRUE             # Should sections (and thus figures and tables) be numbered?
fontsize: 12pt                  # Set fontsize
linestretch: 1.5               # Set distance between lines.
link-citations: TRUE            # This creates dynamic links to the papers in reference list.

### Adding additional latex packages:
# header-includes:
#    - \usepackage{colortbl} # Add additional packages here.

output:
  pdf_document:
    keep_tex: TRUE
    template: Tex/TexDefault.txt
    fig_width: 3.5 # Adjust default figure sizes. This can also be done in the chunks of the text.
    fig_height: 3.5
abstract: |
  Abstract to be written here. The abstract should not be too long and should provide the reader with a good understanding what you are writing about. Academic papers are not like novels where you keep the reader in suspense. To be effective in getting others to read your paper, be as open and concise about your findings here as possible. Ideally, upon reading your abstract, the reader should feel he / she must read your paper in entirety.
---

<!-- First: Set your default preferences for chunk options: -->

<!-- If you want a chunk's code to be printed, set echo = TRUE. message = FALSE stops R printing ugly package loading details in your final paper too. I also suggest setting warning = FALSE and checking for warnings in R, else you might find ugly warnings in your paper. -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 6, fig.height = 5, fig.pos="H", fig.pos = 'H')
# Note: Include = FALSE implies the code is executed, but not printed in your pdf.
# warning and message = FALSE implies ugly messages and warnings are removed from your pdf.
# These should be picked up when you execute the command chunks (code sections below) in your rmd, not printed in your paper!

# Lets load in example data, and see how this can be stored and later called from your 'data' folder.
if(!require("tidyverse")) install.packages("tidyverse")
library(tidyverse)


# Notice that as you are working in a .Rproj file (I am assuming you are) - the relative paths of your directories start at your specified root.
# This means that when working in a .Rproj file, you never need to use getwd() - it is assumed as your base root automatically.
source("/Users/sahilbhugwan/Downloads/Data science/Data Science 871 ML project/code/Loading data.R")

#Data exploration 
source("/Users/sahilbhugwan/Downloads/Data science/Data Science 871 ML project/code/Data Exploration.R")


```

<!-- ############################## -->

<!-- # Start Writing here: -->

<!-- ############################## -->

# Introduction \label{Introduction}

# Idea

The main idea of this project is to try and predict who should have won the 2022 FIFA world cup in Qatar. My idea was to look at all the past international matches that has been played since 1872. The reason for this is sometimes there tends to be patterns that emerge, as in sports there is an old saying that history repeats itself. As well as when one views sport on TV many analysts tend to compare current matches to past ones. I then will also look at the ranking of the teams in the World cup as that usual as some indication on how well a team is doing leading to a world cup. This is because if a team is ranking high it generally indicates that they are performing well and winning consistently.

# Data

The data that i will be using for this project will be all the international soccer matches which i found on Kaggle. This data set includes all the matches that was played it has both home and away team, there scores as well as the tournament that the match was being played. Given that this data set included data on all soccer matches up an till after the world cup i then filtered the data to just before the world cup as i want to predict the matches in the world cup based on past performance. The next data set i loaded was the FIFA world cup ranking. This data set contains the ranking of teams since its inception in 1992. It is updated based on when international matches therefore there is no consistent pattern to when it was updated. After that i then converted the data to date time as well as filtered the data from August 1, 2018, onward. Given that certain teams in the data set have different names i then filtered it so that there is consistency throughout. I then merged the data set with the games played. Below is an example using Brazil as an example.

```{r Figure1,  warning =  FALSE, fig.align = 'center', fig.cap = "Brazil matches  \\label{Figure1}", fig.ext = 'png', fig.height = 3, fig.width = 6}


tail(df_wc_ranked[df_wc_ranked$home_team == "Brazil" | df_wc_ranked$away_team == "Brazil", ], 10)
```

Lastly i then loaded the FIFA world cup matches that will be played in Qatar as well as the teams and group allocations.

# Data Exploration

In this section i will do some analysis on the past 150 years of soccer matches. During the international season international teams play a wide range of different games that include friendly matches, world cup/ continent qualifiers as well specific tournaments. However one must take note that the FIFA world cup only takes places every 4 years and if a team plays all the group stage matches and all the knock out matches then the maximum games they will play will be 7 matches therefore in total a FIFA world cup only consists of 64 games every 4 years. Therefore in a 4 year cycle majority of international matches will be be friendly games.

```{r Figure2,  warning =  FALSE, fig.align = 'center', fig.cap = "Annual Matches  \\label{Figure2}", fig.ext = 'png', fig.height = 6, fig.width = 7}

Annualmatches

```

as seen in Figure \ref{Figure2} it clear that majority of the games that a team plays is friendlies. FIFA world cup qualifiers as well as the teams continent qualifiers are the second most matches that international teams will play. This can be examined more clearly on the figure below.

```{r Figure3,  warning =  FALSE, fig.align = 'center', fig.cap = "Break down of matches played   \\label{Figure3}", fig.ext = 'png', fig.height = 4, fig.width = 6}

MajorM
```

Therefore one can see that it is vital that teams perform well in qulifications and friendly matches as it will allow the team to build moment to going into a major tournament. As when a team makes the tournament they play a handful of games and once they make the knock out matches there is no room for error.

Given that teams play a lot of friendly games one most ask the question how how important these games are in the context of winning a world cup. Intuitively it makes sense that the qualification games are important vital, as a team has to qualify for a world cup in order to win a world cup. looking at the continental tournaments such as Euro or African cup of nations they are important matches in terms of finding out who the best team in in that specific continent. However those maths don't have an impact on the world cup, as a team can when the that trophy and still not qualify for the world cup. an example of that most recently was Italy that won the Euro in 2021 but failed to qualify for the 2022 world cup. The figure below is a break down of importance of each tournament.

```{r Figure4,  warning =  FALSE, fig.align = 'center', fig.cap = "Importance by tournmnet    \\label{Figure4}", fig.ext = 'png', fig.height = 7, fig.width = 6}

IBT
```

Therefore is a countries sole purpose is to win the FIFA world cup they should be looking to perform there best during the FIFA world cup qualifications therefore increasing there chance of making it it to the world cup. One important consideration that should be noted is that friendlies and any qualification have an impact on the teams rankings in the world, this is a psychological factor that can impact on how the teams perform in crunch matches.

Therefore i will next look at all the previous FIFA world cup winners as illustrated in the graph below.

```{r Figure5,  warning =  FALSE, fig.align = 'center', fig.cap = "FIFA World Cup Winners     \\label{Figure5}", fig.ext = 'png', fig.height = 6, fig.width = 6}

WCW

```

It should be noted that the first FIFA world cup was played in 1932 and is played every 4 years. There was however only two world cups that where played this was due to World War 2. Looking at this graph it is clear that Brazil is by far the best performing team at the world cup. Just for interest Brazil is also the only team in the world to have played at every single world cup since its inception in 1932, which clearly shows that by playing in world cups it does increase the likelyhood of winning the tournament.

# Initial Plan for Feature Engineering 

my initial idea was to to look at a wide range of features to try and predict who should have one the FIFA world cup. To do this i was going to look ranking , points, home/away fixtures as well as a variety of other features. However i ran into a few issues with the code not being able to producing spuriousness results. The code for this can be viewed on github on previous commits

# Feature Engineering 

Given this i decided to simplify it even further I decided to predict the teams survival of making out the group stages of the World cup. Given that 32 teams start the world cup, i wanted to see after the group stage matches with 16 teams will remain. To do this i will only be looking at only a few features that being matches from 1992 the reason why i decided to look from matches from there is due to the fact that teams rankings where first introduced back in 1992. Therefore from this i can see the changes in the rank of the team and work out the average rank of the team these are all done by looking at the total points that a team gets from playing international matches. The other additional features that i will be looking at is where the match that they playing has some level of stake (importance of the game) and it it was played at a world cup.

# Training 

In this section i will discuss what i did with regards to predicting the matches. The first thing that is done is to split the model into two different sections that being training and testing sets for machine learning. By splitting the data into different sets i can use the X_train and y_train sets to evaluate the performance on the unseen data using the X_test and y_test sets. Therefore by separating these sets will allow for the model to asses it ability with regards to being able to generate new, unseen data that and thereby avoid overfitting with regards to the training data.

Here i will be using the features that i mentioned earlier (that being average rank, rank difference , point difference , stake of match and lastly if it was played at a world cup). These features i will be using for training the machine learning models.
